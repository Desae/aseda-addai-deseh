name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    # -----------------------------
    # 1. Check out repository
    # -----------------------------
    - name: Check out repository
      uses: actions/checkout@v3

    # -----------------------------
    # 2. Install Python (3.11)
    # -----------------------------
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: "3.11"

    # -----------------------------
    # 3. Create Conda environment (if environment.yml exists)
    #    Many hackathon participants will rely on pip instead.
    # -----------------------------
    - name: Install dependencies via pip
      run: |
        python -m pip install --upgrade pip
        # Install only what's required for TEST.sh to run
        pip install google-generativeai python-dotenv requests typing_extensions

    # -----------------------------
    # 4. Ensure TEST.sh is executable
    # -----------------------------
    - name: Make TEST.sh executable
      run: chmod +x TEST.sh

    # -----------------------------
    # 5. Run TEST.sh smoke test
    # -----------------------------
    - name: Run smoke test
      run: ./TEST.sh
